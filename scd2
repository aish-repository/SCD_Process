select order_ts,nw.orderNumber,orderDate,requiredDate,shippedDate,status,comments,customerNumber,coalesce((old_max_version + row_number() over (partition by nw.orderNumber order by order_ts) ),row_number() over (partition by nw.orderNumber order by order_ts)) as version from tv_orders_new nw  left join (select max(version) as old_max_version,orderNumber from tv_orders_old group by orderNumber) old on old.orderNumber = nw.orderNumber        union select * from tv_orders_old 
